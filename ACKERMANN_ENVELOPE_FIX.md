# é˜¿å…‹æ›¼åº•ç›˜è½¦è¾†åŒ…ç»œä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼š
- navsim-onlineï¼ˆWeb å‰ç«¯ï¼‰ä¸­çš„é˜¿å…‹æ›¼åº•ç›˜è½¦è¾†å¯è§†åŒ–ä¸å‡†ç¡®
- navsim-localï¼ˆæœ¬åœ°å¯è§†åŒ–ï¼‰ä¸­çš„é˜¿å…‹æ›¼åº•ç›˜è½¦è¾†è½®å»“ä¸å‡†ç¡®
- ä¸¤è€…çš„è½¦è¾†åŒ…ç»œè®¡ç®—æ–¹å¼ä¸ä¸€è‡´

**æ ¹æœ¬åŸå› **ï¼š
1. **navsim-local**ï¼šä½¿ç”¨äº†é”™è¯¯çš„å‰ä¿é™©æ  X åæ ‡ï¼ˆ`total_length` è€Œä¸æ˜¯ `wheelbase + front_overhang`ï¼‰
2. **navsim-online**ï¼šThree.js çš„ `BoxGeometry` é»˜è®¤ä»¥å‡ ä½•ä¸­å¿ƒä¸ºåŸç‚¹ï¼Œä½†æ²¡æœ‰è°ƒæ•´è½¦ä½“ä½ç½®ä»¥åŒ¹é…åè½´ä¸­å¿ƒ

---

## ğŸ“ æ ‡å‡†å®šä¹‰

### åæ ‡ç³»åŸºå‡†

**åè½´ä¸­å¿ƒä¸ºåŸç‚¹ (0, 0)**ï¼š
- **X è½´æ–¹å‘**ï¼šå‘å‰ä¸ºæ­£
- **Y è½´æ–¹å‘**ï¼šå‘å·¦ä¸ºæ­£
- **Z è½´æ–¹å‘**ï¼šå‘ä¸Šä¸ºæ­£

### åŒ…ç»œè®¡ç®—å…¬å¼

ç»™å®šå‚æ•°ï¼š
- è½´è·ï¼š`L` (wheelbase)
- å‰æ‚¬ï¼š`FOH` (front_overhang)
- åæ‚¬ï¼š`ROH` (rear_overhang)
- è½¦å®½ï¼š`W` (width)

**å…³é”®åæ ‡**ï¼š
```
å‰ä¿é™©æ  X åæ ‡ï¼šx_front = L + FOH
åä¿é™©æ  X åæ ‡ï¼šx_rear = -ROH
è½¦é•¿ï¼ˆæ ¡éªŒï¼‰ï¼štotal_length = FOH + L + ROH
```

**è½¦è¾†åŒ…ç»œçš„å››ä¸ªè§’ç‚¹**ï¼ˆé€†æ—¶é’ˆé¡ºåºï¼‰ï¼š
```
P1 (å‰å·¦) = (L + FOH,  +W/2)
P2 (å‰å³) = (L + FOH,  -W/2)
P3 (åå³) = (-ROH,     -W/2)
P4 (åå·¦) = (-ROH,     +W/2)
```

### å…·ä½“ç¤ºä¾‹

**å·²çŸ¥å‚æ•°**ï¼š
```
è½´è· L = 2.8 m
å‰æ‚¬ FOH = 0.9 m
åæ‚¬ ROH = 0.8 m
è½¦å®½ W = 1.8 m
è½¦é•¿ = 4.5 mï¼ˆæ ¡éªŒï¼š0.9 + 2.8 + 0.8 = 4.5 âœ“ï¼‰
```

**è®¡ç®—ç»“æœ**ï¼š
```
å‰ä¿é™©æ  X åæ ‡ï¼šx_front = 2.8 + 0.9 = 3.7 m
åä¿é™©æ  X åæ ‡ï¼šx_rear = -0.8 m
Y æ–¹å‘åŠå®½ï¼šW/2 = 1.8/2 = 0.9 m
```

**å››ä¸ªè§’ç‚¹åæ ‡**ï¼š
```
P1 (å‰å·¦) = (3.7,  +0.9)
P2 (å‰å³) = (3.7,  -0.9)
P3 (åå³) = (-0.8, -0.9)
P4 (åå·¦) = (-0.8, +0.9)
```

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. navsim-local ä¿®å¤

**åŸå§‹ä»£ç **ï¼ˆé”™è¯¯ï¼‰ï¼š
```cpp
double total_length = ego_.kinematics.front_overhang + 
                     ego_.kinematics.wheelbase + 
                     ego_.kinematics.rear_overhang;
double half_width = ego_.kinematics.body_width / 2.0;

std::vector<std::pair<double, double>> corners_local = {
  {total_length, half_width},   // âŒ é”™è¯¯ï¼šå‰å·¦ = (4.5, 0.9)
  {total_length, -half_width},  // âŒ é”™è¯¯ï¼šå‰å³ = (4.5, -0.9)
  {-ego_.kinematics.rear_overhang, -half_width},  // âœ… æ­£ç¡®ï¼šåå³ = (-0.8, -0.9)
  {-ego_.kinematics.rear_overhang, half_width}    // âœ… æ­£ç¡®ï¼šåå·¦ = (-0.8, 0.9)
};
```

**é—®é¢˜åˆ†æ**ï¼š
- `total_length = 0.9 + 2.8 + 0.8 = 4.5`
- å‰å·¦è§’ç‚¹ = `(4.5, 0.9)` âŒ **é”™è¯¯ï¼**
- åº”è¯¥æ˜¯ `(3.7, 0.9)` âœ…

**ä¿®å¤åçš„ä»£ç **ï¼š
```cpp
// ğŸ”§ æ ‡å‡†å®šä¹‰ï¼šåè½´ä¸­å¿ƒä¸ºåŸç‚¹ï¼ŒX è½´å‘å‰ä¸ºæ­£ï¼ŒY è½´å‘å·¦ä¸ºæ­£
double half_width = ego_.kinematics.body_width / 2.0;

// ğŸ”§ å‰ä¿é™©æ  X åæ ‡ = wheelbase + front_overhangï¼ˆä»åè½´å¼€å§‹ï¼‰
double x_front = ego_.kinematics.wheelbase + ego_.kinematics.front_overhang;
// ğŸ”§ åä¿é™©æ  X åæ ‡ = -rear_overhangï¼ˆä»åè½´å¼€å§‹ï¼Œå‘åä¸ºè´Ÿï¼‰
double x_rear = -ego_.kinematics.rear_overhang;

// ğŸ”§ è®¡ç®—è½¦è¾†çš„å››ä¸ªè§’ç‚¹ï¼ˆåœ¨è½¦è¾†å±€éƒ¨åæ ‡ç³»ä¸­ï¼Œåè½´ä¸ºåŸç‚¹ï¼‰
std::vector<std::pair<double, double>> corners_local = {
  {x_front, half_width},   // P1: å‰å·¦ = (3.7, +0.9) âœ…
  {x_front, -half_width},  // P2: å‰å³ = (3.7, -0.9) âœ…
  {x_rear, -half_width},   // P3: åå³ = (-0.8, -0.9) âœ…
  {x_rear, half_width}     // P4: åå·¦ = (-0.8, +0.9) âœ…
};
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `navsim-local/src/viz/imgui_visualizer.cpp`ï¼ˆç¬¬ 812-829 è¡Œï¼‰

---

### 2. navsim-online ä¿®å¤

**åŸå§‹ä»£ç **ï¼ˆé”™è¯¯ï¼‰ï¼š
```javascript
const body = new THREE.Mesh(
  new THREE.BoxGeometry(geom.body_length, geom.body_height, geom.body_width),
  bodyMaterial
);
body.position.y = geom.body_height / 2;  // âŒ åªè®¾ç½®äº† Y åæ ‡
group.add(body);

const wheelPositions = [
  { x: config.wheelbase / 2, z: wheelLateralOffset },      // âŒ é”™è¯¯
  { x: config.wheelbase / 2, z: -wheelLateralOffset },     // âŒ é”™è¯¯
  { x: -config.wheelbase / 2, z: wheelLateralOffset },     // âŒ é”™è¯¯
  { x: -config.wheelbase / 2, z: -wheelLateralOffset }     // âŒ é”™è¯¯
];
```

**é—®é¢˜åˆ†æ**ï¼š
- Three.js çš„ `BoxGeometry` é»˜è®¤ä»¥**å‡ ä½•ä¸­å¿ƒ**ä¸ºåŸç‚¹
- ä½† `egoGroup.position` è®¾ç½®ä¸ºåè½´ä½ç½®
- å¯¼è‡´è½¦ä½“ç›¸å¯¹äºåè½´çš„ä½ç½®ä¸æ­£ç¡®

**Three.js åæ ‡ç³»æ˜ å°„**ï¼š
```
æˆ‘ä»¬çš„åæ ‡ç³»        Three.js ä¸–ç•Œåæ ‡ç³»
X è½´ï¼ˆå‘å‰ï¼‰   â†’    X è½´ï¼ˆå‘å³ï¼‰
Y è½´ï¼ˆå‘å·¦ï¼‰   â†’    -Z è½´ï¼ˆå‘å‰ï¼‰
Z è½´ï¼ˆå‘ä¸Šï¼‰   â†’    Y è½´ï¼ˆå‘ä¸Šï¼‰

navToScenePosition(x, y) æ˜ å°„ï¼š
æˆ‘ä»¬çš„ X â†’ Three.js çš„ X
æˆ‘ä»¬çš„ Y â†’ Three.js çš„ -Z

å› æ­¤ï¼šæˆ‘ä»¬çš„"å‘å‰"å¯¹åº” Three.js çš„"å‘å³"
```

**ä¿®å¤åçš„ä»£ç **ï¼š
```javascript
// ğŸ”§ è®¡ç®—è½¦ä½“åœ¨å±€éƒ¨åæ ‡ç³»ä¸­çš„åç§»
// è½¦ä½“å‡ ä½•ä¸­å¿ƒç›¸å¯¹äºåè½´çš„åç§»
const bodyOffsetX = (config.wheelbase + geom.front_overhang - geom.rear_overhang) / 2;
// ç¤ºä¾‹ï¼š(2.8 + 0.9 - 0.8) / 2 = 1.45 m

const body = new THREE.Mesh(
  new THREE.BoxGeometry(geom.body_length, geom.body_height, geom.body_width),  // ğŸ”§ é•¿åº¦åœ¨ Xï¼Œå®½åº¦åœ¨ Z
  bodyMaterial
);
// ğŸ”§ è½¦ä½“ä½ç½®ï¼šX æ–¹å‘åç§»ï¼ˆå› ä¸ºæˆ‘ä»¬çš„"å‘å‰"å¯¹åº” Three.js çš„ Xï¼‰
body.position.set(bodyOffsetX, geom.body_height / 2, 0);  // âœ… æ­£ç¡®
group.add(body);

// ğŸ”§ è½®å­ä½ç½®ï¼ˆåŸºäºåè½´ä¸­å¿ƒï¼‰
// æˆ‘ä»¬çš„åæ ‡ç³»ï¼šX å‘å‰ï¼ŒY å‘å·¦
// Three.js å±€éƒ¨åæ ‡ç³»ï¼šX å‘å³ï¼ŒZ å‘å‰
// æ˜ å°„ï¼šæˆ‘ä»¬çš„ X â†’ Three.js çš„ Xï¼Œæˆ‘ä»¬çš„ Y â†’ Three.js çš„ -Z
const wheelPositions = [
  { x: config.wheelbase, z: -wheelLateralOffset },      // å‰å·¦ âœ…
  { x: config.wheelbase, z: wheelLateralOffset },       // å‰å³ âœ…
  { x: 0, z: -wheelLateralOffset },                     // åå·¦ï¼ˆåè½´ï¼‰âœ…
  { x: 0, z: wheelLateralOffset }                       // åå³ï¼ˆåè½´ï¼‰âœ…
];

// ğŸ”§ è½®å­æ—‹è½¬ï¼šç»• X è½´æ—‹è½¬ 90 åº¦
wheel.rotation.x = Math.PI / 2;
```

**è½¦ä½“åç§»è®¡ç®—**ï¼š
```
å‰ä¿é™©æ  X = wheelbase + front_overhang = 2.8 + 0.9 = 3.7 m
åä¿é™©æ  X = -rear_overhang = -0.8 m
è½¦ä½“å‡ ä½•ä¸­å¿ƒ X = (3.7 + (-0.8)) / 2 = 1.45 m
Three.js å±€éƒ¨ X åæ ‡ = 1.45 mï¼ˆå› ä¸ºæˆ‘ä»¬çš„ X å‘å‰ â†’ Three.js çš„ X å‘å³ï¼‰âœ…
```

**ä¿®å¤æ–‡ä»¶**ï¼š
- `navsim-online/web/index.html`ï¼ˆç¬¬ 2368-2411 è¡Œï¼Œè‡ªè½¦ï¼‰
- `navsim-online/web/index.html`ï¼ˆç¬¬ 2625-2655 è¡Œï¼ŒåŠ¨æ€éšœç¢ç‰©ï¼‰

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### navsim-local

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **å‰å·¦è§’ç‚¹** | (4.5, 0.9) âŒ | (3.7, 0.9) âœ… |
| **å‰å³è§’ç‚¹** | (4.5, -0.9) âŒ | (3.7, -0.9) âœ… |
| **åå³è§’ç‚¹** | (-0.8, -0.9) âœ… | (-0.8, -0.9) âœ… |
| **åå·¦è§’ç‚¹** | (-0.8, 0.9) âœ… | (-0.8, 0.9) âœ… |
| **è½¦å¤´ä½ç½®** | (4.5, 0) âŒ | (3.7, 0) âœ… |

### navsim-online

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **è½¦ä½“ä¸­å¿ƒ Z** | 0 âŒ | 1.45 âœ… |
| **å‰å·¦è½® Z** | 1.4 âŒ | 2.8 âœ… |
| **å‰å³è½® Z** | 1.4 âŒ | 2.8 âœ… |
| **åå·¦è½® Z** | -1.4 âŒ | 0 âœ… |
| **åå³è½® Z** | -1.4 âŒ | 0 âœ… |

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### 1. è§†è§‰éªŒè¯

**navsim-local**ï¼š
1. é‡å¯ navsim-local
2. é€‰æ‹©é˜¿å…‹æ›¼åº•ç›˜
3. è§‚å¯Ÿè½¦è¾†è½®å»“ï¼š
   - åè½´ä½ç½®åº”è¯¥æœ‰çº¢è‰²åœ†ç‚¹ï¼ˆå‚è€ƒç‚¹ï¼‰
   - è½¦å¤´ä½ç½®åº”è¯¥æœ‰é»„è‰²åœ†ç‚¹
   - è½¦è¾†é•¿åº¦åº”è¯¥æ˜¯ `wheelbase + front_overhang + rear_overhang`

**navsim-online**ï¼š
1. åˆ·æ–° Web é¡µé¢
2. é€‰æ‹©é˜¿å…‹æ›¼åº•ç›˜
3. è§‚å¯Ÿè½¦è¾†æ¨¡å‹ï¼š
   - åè½®åº”è¯¥åœ¨åè½´ä½ç½®ï¼ˆZ = 0ï¼‰
   - å‰è½®åº”è¯¥åœ¨å‰è½´ä½ç½®ï¼ˆZ = wheelbaseï¼‰
   - è½¦ä½“åº”è¯¥å±…ä¸­

### 2. æ•°å€¼éªŒè¯

**ç¤ºä¾‹å‚æ•°**ï¼š
```
wheelbase = 2.8 m
front_overhang = 0.9 m
rear_overhang = 0.8 m
width = 1.8 m
```

**é¢„æœŸç»“æœ**ï¼š
```
å‰ä¿é™©æ  X = 2.8 + 0.9 = 3.7 m âœ…
åä¿é™©æ  X = -0.8 m âœ…
è½¦é•¿ = 0.9 + 2.8 + 0.8 = 4.5 m âœ…
è½¦ä½“ä¸­å¿ƒ X = (3.7 - 0.8) / 2 = 1.45 m âœ…
```

### 3. ä¸€è‡´æ€§éªŒè¯

**å‰ç«¯å’Œæœ¬åœ°åº”è¯¥ä¸€è‡´**ï¼š
- è½¦è¾†åŒ…ç»œçš„å››ä¸ªè§’ç‚¹åº”è¯¥ç›¸åŒ
- è½¦å¤´ä½ç½®åº”è¯¥ç›¸åŒ
- åè½´ä½ç½®åº”è¯¥ç›¸åŒ

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰

**navsim-local**ï¼š
```
è½¦è¾†è¿‡é•¿ï¼Œå‰ä¿é™©æ ä½ç½®é”™è¯¯
å‰ä¿é™©æ  X = 4.5 mï¼ˆåº”è¯¥æ˜¯ 3.7 mï¼‰âŒ
è¯¯å·® = 0.8 mï¼ˆåæ‚¬çš„é•¿åº¦ï¼‰
```

**navsim-online**ï¼š
```
è½¦ä½“ä½ç½®ä¸æ­£ç¡®ï¼Œç›¸å¯¹äºåè½´åç§»é”™è¯¯
è½¦ä½“æœå‘é”™è¯¯ï¼ˆæ¨ªå‘è€Œä¸æ˜¯çºµå‘ï¼‰âŒ
BoxGeometry å‚æ•°é¡ºåºé”™è¯¯âŒ
è½®å­ä½ç½®é”™è¯¯âŒ
è½®å­æ—‹è½¬è½´é”™è¯¯âŒ
```

### ä¿®å¤å

**navsim-local**ï¼š
```
è½¦è¾†è½®å»“å‡†ç¡®
å‰ä¿é™©æ  X = 3.7 m âœ…
åä¿é™©æ  X = -0.8 m âœ…
è½¦é•¿ = 4.5 m âœ…
```

**navsim-online**ï¼š
```
è½¦ä½“ä½ç½®å‡†ç¡®
è½¦ä½“ä¸­å¿ƒ X = 1.45 m âœ…
è½¦ä½“æœå‘æ­£ç¡®ï¼ˆä¸ç™½è‰²ç®­å¤´ä¸€è‡´ï¼‰âœ…
å‰è½® X = 2.8 mï¼ˆå‰è½´ï¼‰âœ…
åè½® X = 0 mï¼ˆåè½´ï¼‰âœ…
BoxGeometry å‚æ•°æ­£ç¡®ï¼ˆlength, height, widthï¼‰âœ…
è½®å­æ—‹è½¬è½´æ­£ç¡®ï¼ˆrotation.xï¼‰âœ…
```

**å‰ç«¯å’Œæœ¬åœ°ä¸€è‡´**ï¼š
```
ä¸¤è€…çš„è½¦è¾†åŒ…ç»œå®Œå…¨ä¸€è‡´ âœ…
è½¦å¤´ä½ç½®ä¸€è‡´ âœ…
åè½´ä½ç½®ä¸€è‡´ âœ…
```

---

**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-10-14  
**ç¼–è¯‘çŠ¶æ€**ï¼šâœ… æˆåŠŸ  
**æµ‹è¯•çŠ¶æ€**ï¼šâ³ å¾…ç”¨æˆ·éªŒè¯

**ä¿®å¤æ–‡ä»¶æ€»ç»“**ï¼š
1. âœ… `navsim-local/src/viz/imgui_visualizer.cpp`ï¼ˆç¬¬ 812-863 è¡Œï¼‰
2. âœ… `navsim-online/web/index.html`ï¼ˆç¬¬ 2368-2411 è¡Œï¼Œè‡ªè½¦ï¼‰
3. âœ… `navsim-online/web/index.html`ï¼ˆç¬¬ 2625-2655 è¡Œï¼ŒåŠ¨æ€éšœç¢ç‰©ï¼‰

